<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>OFFICE FEAST - ‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏î‡∏à‡∏≤‡∏Å‡∏ï‡∏•‡∏≤‡∏î</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700;800;900&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#FAF7F2;--card:#FFF;--primary:#E8533F;--primary-dark:#C7402F;--accent:#FF8C42;--green:#2ECC71;--green-dark:#27AE60;--text:#2D2A26;--text-light:#8A8580;--text-mid:#5C5955;--border:#EDE8E1;--shadow:0 2px 16px rgba(45,42,38,.06);--radius:20px;--radius-sm:14px}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Sarabun',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
.header{position:sticky;top:0;z-index:100;background:rgba(250,247,242,.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);padding:16px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border)}
.logo{font-family:'Prompt',sans-serif;font-weight:900;font-size:22px;letter-spacing:2px;display:flex;align-items:center;gap:8px}
.logo-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--primary),var(--accent));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;color:#fff;box-shadow:0 4px 12px rgba(232,83,63,.3)}
.header-right{display:flex;align-items:center;gap:10px}
.cart-btn,.admin-btn{position:relative;width:48px;height:48px;background:var(--card);border:none;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;box-shadow:var(--shadow);transition:all .2s}
.cart-btn:active,.admin-btn:active{transform:scale(.92)}
.cart-badge{position:absolute;top:-4px;right:-4px;background:var(--primary);color:#fff;font-family:'Prompt',sans-serif;font-weight:700;font-size:11px;width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(232,83,63,.4);transition:all .3s;opacity:0;transform:scale(0)}
.cart-badge.show{opacity:1;transform:scale(1)}
.page{display:none;padding:20px;padding-bottom:100px;animation:fadeIn .35s ease}.page.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes scaleIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
@keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
.hero-banner{background:linear-gradient(135deg,var(--primary),var(--accent));border-radius:var(--radius);padding:28px 24px;margin-bottom:28px;position:relative;overflow:hidden;box-shadow:0 8px 32px rgba(232,83,63,.25)}
.hero-banner::before{content:'';position:absolute;top:-40%;right:-20%;width:200px;height:200px;background:rgba(255,255,255,.1);border-radius:50%}
.hero-title{font-family:'Prompt',sans-serif;font-weight:800;font-size:26px;color:#fff;margin-bottom:6px;position:relative;z-index:1}
.hero-subtitle{font-size:15px;color:rgba(255,255,255,.85);position:relative;z-index:1}
.hero-emoji{position:absolute;right:20px;top:50%;transform:translateY(-50%);font-size:64px;z-index:1}
.featured-card{background:var(--card);border-radius:var(--radius);margin-bottom:24px;overflow:hidden;box-shadow:var(--shadow);cursor:pointer;transition:all .3s}
.featured-card:active{transform:scale(.98)}
.featured-img{width:100%;height:180px;background:linear-gradient(135deg,#FFE5D9,#FFC3A0);display:flex;align-items:center;justify-content:center;font-size:80px;position:relative;overflow:hidden}
.featured-tag{position:absolute;top:14px;left:14px;background:var(--primary);color:#fff;font-family:'Prompt',sans-serif;font-weight:600;font-size:12px;padding:5px 14px;border-radius:20px;z-index:2}
.featured-info{padding:18px 20px}
.featured-name{font-family:'Prompt',sans-serif;font-weight:700;font-size:20px;margin-bottom:4px}
.featured-price{font-family:'Prompt',sans-serif;font-weight:600;font-size:18px;color:var(--primary)}
.section-title{font-family:'Prompt',sans-serif;font-weight:700;font-size:20px;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.category-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:20px}
.category-card{background:var(--card);border-radius:var(--radius-sm);text-align:center;cursor:pointer;box-shadow:var(--shadow);transition:all .25s;border:2px solid transparent;overflow:hidden;padding:20px 12px}
.category-card:active{transform:scale(.95)}
.category-name{font-family:'Prompt',sans-serif;font-weight:600;font-size:17px;margin-top:8px}
.category-count{font-size:13px;color:var(--text-light);margin-top:2px}
.back-btn{display:inline-flex;align-items:center;gap:6px;font-family:'Prompt',sans-serif;font-weight:600;font-size:15px;color:var(--text-mid);background:none;border:none;cursor:pointer;margin-bottom:16px;padding:8px 0}
.cat-header{font-family:'Prompt',sans-serif;font-weight:800;font-size:26px;margin-bottom:20px;display:flex;align-items:center;gap:10px}
.product-card{background:var(--card);border-radius:var(--radius-sm);padding:14px;margin-bottom:12px;display:flex;align-items:center;gap:14px;box-shadow:var(--shadow);animation:slideUp .4s ease both}
.product-info{flex:1;min-width:0}
.product-name{font-family:'Prompt',sans-serif;font-weight:600;font-size:16px;margin-bottom:2px}
.product-price{font-family:'Prompt',sans-serif;font-weight:700;font-size:16px;color:var(--primary)}
.product-unit{font-size:13px;color:var(--text-light)}
.qty-control{display:flex;align-items:center;background:var(--bg);border-radius:12px;overflow:hidden;flex-shrink:0}
.qty-btn{width:38px;height:38px;border:none;background:transparent;font-family:'Prompt',sans-serif;font-weight:700;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.qty-btn:active{background:var(--border)}
.qty-btn.minus{color:var(--primary)}.qty-btn.plus{color:var(--green)}
.qty-value{width:32px;text-align:center;font-family:'Prompt',sans-serif;font-weight:700;font-size:16px}
.cart-empty{text-align:center;padding:60px 20px}
.cart-empty-icon{font-size:72px;margin-bottom:16px}
.cart-empty-text{font-family:'Prompt',sans-serif;font-weight:600;font-size:18px;color:var(--text-light)}
.cart-item{background:var(--card);border-radius:var(--radius-sm);padding:12px;margin-bottom:10px;display:flex;align-items:center;gap:12px;box-shadow:var(--shadow)}
.cart-item-info{flex:1;min-width:0}
.cart-item-name{font-family:'Prompt',sans-serif;font-weight:600;font-size:15px}
.cart-item-price{font-family:'Prompt',sans-serif;font-weight:700;font-size:15px;color:var(--primary)}
.remove-btn{width:36px;height:36px;border-radius:10px;border:none;background:#FFF0EE;color:var(--primary);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.summary-card{background:var(--card);border-radius:var(--radius);padding:20px;margin-top:20px;box-shadow:var(--shadow)}
.summary-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;font-size:15px}
.summary-row.total{border-top:2px dashed var(--border);margin-top:8px;padding-top:14px;font-family:'Prompt',sans-serif;font-weight:700;font-size:20px}
.total-amount{color:var(--primary)}
.summary-label{color:var(--text-mid)}
.payment-section{margin-top:24px}
.payment-title{font-family:'Prompt',sans-serif;font-weight:700;font-size:18px;margin-bottom:14px}
.payment-options{display:flex;flex-direction:column;gap:12px}
.payment-option{background:var(--card);border:2px solid var(--border);border-radius:var(--radius-sm);padding:18px;cursor:pointer;transition:all .25s;display:flex;align-items:center;gap:14px}
.payment-option.selected{border-color:var(--primary);background:#FFF8F6;box-shadow:0 0 0 3px rgba(232,83,63,.1)}
.payment-radio{width:24px;height:24px;border-radius:50%;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.payment-option.selected .payment-radio{border-color:var(--primary);background:var(--primary)}
.payment-option.selected .payment-radio::after{content:'\2713';color:#fff;font-size:14px;font-weight:700}
.payment-option-info{flex:1}
.payment-option-title{font-family:'Prompt',sans-serif;font-weight:600;font-size:16px}
.payment-option-desc{font-size:13px;color:var(--text-light);margin-top:2px}
.payment-option-badge{background:var(--accent);color:#fff;font-family:'Prompt',sans-serif;font-weight:600;font-size:11px;padding:3px 10px;border-radius:20px;flex-shrink:0}
.payment-option-badge.free{background:var(--green)}
.input-group{margin-bottom:14px}
.input-label{font-family:'Prompt',sans-serif;font-weight:600;font-size:14px;color:var(--text-mid);margin-bottom:6px;display:block}
.input-field{width:100%;padding:14px 16px;border:2px solid var(--border);border-radius:12px;font-family:'Sarabun',sans-serif;font-size:16px;color:var(--text);background:var(--card);outline:none;transition:border-color .2s}
.input-field:focus{border-color:var(--primary)}
.input-field::placeholder{color:#C5C0BA}
.qr-section{text-align:center;padding:24px;background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);margin-top:20px}
.qr-box{width:220px;height:220px;margin:16px auto;background:#fff;border-radius:16px;border:3px solid var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden}
.qr-box img{width:100%;height:100%;object-fit:contain}
.qr-amount{font-family:'Prompt',sans-serif;font-weight:800;font-size:28px;color:var(--primary);margin-top:12px}
.qr-note{font-size:14px;color:var(--text-light);margin-top:8px}
.slip-area{width:100%;max-width:260px;margin:10px auto;aspect-ratio:3/4;border:3px dashed var(--border);border-radius:var(--radius);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;overflow:hidden;position:relative;background:var(--card);transition:all .25s}
.slip-area.has-img{border-style:solid;border-color:var(--green)}
.slip-area img{width:100%;height:100%;object-fit:cover;position:absolute;top:0;left:0}
.slip-area .remove-img{position:absolute;top:8px;right:8px;width:32px;height:32px;border-radius:50%;background:rgba(0,0,0,.6);color:#fff;border:none;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:3}
.loc-card{background:var(--card);border:2px solid var(--border);border-radius:var(--radius-sm);padding:18px;transition:all .25s}
.loc-card.has-loc{border-color:var(--green);background:#F0FFF4}
.loc-btn{width:100%;padding:14px;background:linear-gradient(135deg,#3498db,#2980b9);color:#fff;border:none;border-radius:12px;font-family:'Prompt',sans-serif;font-weight:700;font-size:15px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;margin-top:10px;box-shadow:0 4px 12px rgba(52,152,219,.3)}
.loc-btn:active{transform:scale(.97)}
.loc-btn.done{background:linear-gradient(135deg,var(--green),var(--green-dark))}
.loc-note{background:#FFF8E1;border:1px solid #FFE082;border-radius:10px;padding:10px 14px;font-size:13px;color:#F57F17;margin-top:10px;line-height:1.5}
.btn-primary{width:100%;padding:16px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;border:none;border-radius:14px;font-family:'Prompt',sans-serif;font-weight:700;font-size:17px;cursor:pointer;box-shadow:0 6px 20px rgba(232,83,63,.35);transition:all .25s;margin-top:20px;display:flex;align-items:center;justify-content:center;gap:8px}
.btn-primary:active{transform:scale(.97)}
.btn-success{background:linear-gradient(135deg,var(--green),var(--green-dark));box-shadow:0 6px 20px rgba(46,204,113,.35)}
.btn-outline{width:100%;padding:14px;background:transparent;color:var(--text);border:2px solid var(--border);border-radius:14px;font-family:'Prompt',sans-serif;font-weight:600;font-size:15px;cursor:pointer;margin-top:10px}
.btn-sm{padding:10px 18px;font-size:14px;margin-top:0;width:auto;border-radius:10px}
.bottom-bar{position:fixed;bottom:0;left:0;right:0;background:rgba(250,247,242,.92);backdrop-filter:blur(20px);border-top:1px solid var(--border);padding:12px 20px;padding-bottom:max(12px,env(safe-area-inset-bottom));z-index:100;display:none;animation:slideUp .3s ease}
.bottom-bar.show{display:block}
.bottom-bar-content{display:flex;align-items:center;gap:14px}
.bottom-bar-info{flex:1}
.bottom-bar-items{font-size:13px;color:var(--text-light)}
.bottom-bar-total{font-family:'Prompt',sans-serif;font-weight:700;font-size:20px;color:var(--primary)}
.bottom-bar-btn{padding:14px 28px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;border:none;border-radius:14px;font-family:'Prompt',sans-serif;font-weight:700;font-size:16px;cursor:pointer;box-shadow:0 4px 16px rgba(232,83,63,.35);display:flex;align-items:center;gap:6px}
.success-page{text-align:center;padding:60px 20px}
.success-icon{width:100px;height:100px;border-radius:50%;background:linear-gradient(135deg,var(--green),var(--green-dark));display:flex;align-items:center;justify-content:center;font-size:48px;margin:0 auto 20px;box-shadow:0 8px 32px rgba(46,204,113,.3);animation:scaleIn .5s ease}
.success-title{font-family:'Prompt',sans-serif;font-weight:800;font-size:26px;margin-bottom:8px}
.success-subtitle{font-size:15px;color:var(--text-light);margin-bottom:30px;line-height:1.6}
.order-id{font-family:'Prompt',sans-serif;font-weight:700;font-size:14px;color:var(--accent);background:#FFF3EB;padding:8px 18px;border-radius:20px;display:inline-block;margin-bottom:24px}
.toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--text);color:#fff;padding:12px 24px;border-radius:12px;font-family:'Prompt',sans-serif;font-weight:500;font-size:14px;z-index:200;opacity:0;transition:all .35s cubic-bezier(.175,.885,.32,1.275);box-shadow:0 8px 24px rgba(0,0,0,.2);white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.admin-header{background:linear-gradient(135deg,#2D2A26,#4A4540);border-radius:var(--radius);padding:24px;margin-bottom:24px;color:#fff;position:relative;overflow:hidden}
.admin-header h2{font-family:'Prompt',sans-serif;font-weight:800;font-size:22px;margin-bottom:4px}
.admin-header p{font-size:14px;opacity:.7}
.admin-stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:24px}
.admin-stat{background:var(--card);border-radius:var(--radius-sm);padding:18px;box-shadow:var(--shadow);text-align:center}
.admin-stat-num{font-family:'Prompt',sans-serif;font-weight:800;font-size:28px;color:var(--primary)}
.admin-stat-label{font-size:13px;color:var(--text-light);margin-top:2px}
.admin-section{margin-bottom:24px}
.admin-section-title{font-family:'Prompt',sans-serif;font-weight:700;font-size:18px;margin-bottom:14px;display:flex;align-items:center;justify-content:space-between}
.admin-cat-header{background:var(--card);border-radius:var(--radius-sm);padding:14px 16px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;box-shadow:var(--shadow);border-left:4px solid var(--primary)}
.admin-cat-name{font-family:'Prompt',sans-serif;font-weight:700;font-size:16px;display:flex;align-items:center;gap:8px}
.admin-item{background:var(--card);border-radius:var(--radius-sm);padding:14px;margin-bottom:10px;display:flex;align-items:center;gap:12px;box-shadow:var(--shadow)}
.admin-item-info{flex:1;min-width:0}
.admin-item-name{font-family:'Prompt',sans-serif;font-weight:600;font-size:15px}
.admin-item-detail{font-size:13px;color:var(--text-light)}
.admin-item-actions{display:flex;gap:6px;flex-shrink:0}
.admin-item-actions button{width:36px;height:36px;border-radius:10px;border:none;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.btn-edit{background:#EBF5FF;color:#3498db}
.btn-del{background:#FFF0EE;color:var(--primary)}
.empty-state{text-align:center;padding:40px 20px;color:var(--text-light)}
.empty-state-icon{font-size:48px;margin-bottom:12px}
.dots-pattern{position:fixed;top:0;left:0;right:0;bottom:0;background-image:radial-gradient(circle,#E0DBD4 1px,transparent 1px);background-size:24px 24px;opacity:.3;pointer-events:none;z-index:-1}
.loading{text-align:center;padding:60px 20px}
.loading-spinner{width:48px;height:48px;border:4px solid var(--border);border-top-color:var(--primary);border-radius:50%;margin:0 auto 16px;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-family:'Prompt',sans-serif;font-weight:600;font-size:16px;color:var(--text-light)}
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:300;display:none;align-items:flex-end;justify-content:center}
.modal-overlay.show{display:flex}
.modal{background:var(--bg);border-radius:24px 24px 0 0;padding:24px;width:100%;max-width:500px;max-height:85vh;overflow-y:auto;animation:slideUp .3s ease}
.modal h3{font-family:'Prompt',sans-serif;font-weight:700;font-size:20px;margin-bottom:20px;display:flex;align-items:center;gap:8px}
.sync-status{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:20px;font-family:'Prompt',sans-serif;font-weight:600;font-size:12px;margin-bottom:20px}
.sync-ok{background:#E8F8F0;color:var(--green-dark)}
.sync-loading{background:#FFF3E0;color:#E67E22}
.sync-error{background:#FFEBEE;color:var(--primary)}
.ann-card{background:var(--card);border-radius:var(--radius);overflow:hidden;margin-bottom:24px;box-shadow:var(--shadow);border-left:5px solid var(--accent)}
.ann-card-header{background:linear-gradient(135deg,var(--primary),var(--accent));padding:14px 20px;color:#fff;font-family:'Prompt',sans-serif;font-weight:700;font-size:17px}
.ann-card-body{padding:16px 20px}
.ann-card-body p{font-size:14px;line-height:1.7;color:var(--text);white-space:pre-line;margin:0}
.ann-card-body img{width:100%;border-radius:10px;margin-top:12px}
.line-warn{background:#E8F5E9;border:2px solid #A5D6A7;border-radius:var(--radius-sm);padding:14px 16px;margin-top:16px;text-align:center}
.line-warn a{display:inline-block;margin-top:8px;padding:10px 20px;background:linear-gradient(135deg,#06C755,#04B34F);color:#fff;border-radius:10px;font-family:'Prompt',sans-serif;font-weight:700;font-size:14px;text-decoration:none}
.date-range{display:flex;gap:10px;margin-bottom:14px;align-items:flex-end}
.date-range .input-group{flex:1;margin-bottom:0}
.summary-list{max-height:400px;overflow-y:auto;margin-top:14px}
.summary-item{background:var(--card);border-radius:var(--radius-sm);padding:12px;margin-bottom:8px;box-shadow:var(--shadow);font-size:14px}
.summary-item-header{display:flex;justify-content:space-between;margin-bottom:4px}
.summary-item-name{font-family:'Prompt',sans-serif;font-weight:600}
.summary-item-total{font-family:'Prompt',sans-serif;font-weight:700;color:var(--primary)}
.summary-item-items{color:var(--text-mid);font-size:13px}
.summary-totals{background:linear-gradient(135deg,var(--primary),var(--accent));border-radius:var(--radius-sm);padding:16px;color:#fff;margin-top:14px;text-align:center}
.summary-totals-num{font-family:'Prompt',sans-serif;font-weight:800;font-size:28px}
.summary-totals-label{font-size:13px;opacity:.8}
.summary-shopping{background:var(--card);border-radius:var(--radius-sm);padding:14px;margin-top:14px;box-shadow:var(--shadow)}
.summary-shopping h4{font-family:'Prompt',sans-serif;font-weight:700;font-size:15px;margin-bottom:8px}
.shopping-item{display:flex;justify-content:space-between;padding:4px 0;font-size:14px;border-bottom:1px solid var(--border)}
.shopping-item:last-child{border-bottom:none}
.btn-line{background:linear-gradient(135deg,#06C755,#04B34F);box-shadow:0 4px 12px rgba(6,199,85,.3)}
.upload-area{width:100%;aspect-ratio:1;max-width:180px;margin:8px auto 12px;border:3px dashed var(--border);border-radius:var(--radius);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;overflow:hidden;position:relative;background:var(--card);transition:all .25s}
.upload-area:active{transform:scale(.97)}
.upload-area.has-img{border-style:solid;border-color:var(--green)}
.upload-area img{width:100%;height:100%;object-fit:cover;position:absolute;top:0;left:0}
.upload-area .remove-img{position:absolute;top:6px;right:6px;width:28px;height:28px;border-radius:50%;background:rgba(0,0,0,.6);color:#fff;border:none;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:3}
.upload-btns{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
.upload-btns button{padding:8px 16px;border:2px solid var(--border);border-radius:10px;background:var(--card);font-family:'Prompt',sans-serif;font-weight:600;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:4px}
.upload-btns button:active{transform:scale(.95)}
.pimg{width:56px;height:56px;border-radius:12px;overflow:hidden;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:#f5f0ea}
.pimg img{width:100%;height:100%;object-fit:cover}
.cimg{width:100%;height:100px;overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:48px;background:#f5f0ea;border-radius:var(--radius-sm) var(--radius-sm) 0 0}
.cimg img{width:100%;height:100%;object-fit:cover}
.category-card{overflow:hidden;padding:0}
.category-card .category-text{padding:14px 12px}
</style>
</head>
<body>
<div class="dots-pattern"></div>
<div class="header">
  <div class="logo"><div class="logo-icon">üç±</div>OFFICE FEAST</div>
  <div class="header-right">
    <button class="admin-btn" onclick="openAdminLogin()" title="Admin">‚öôÔ∏è</button>
    <button class="cart-btn" onclick="showCart()">üõí<div class="cart-badge" id="cartBadge">0</div></button>
  </div>
</div>

<div class="page active" id="homePage">
  <div class="hero-banner"><div class="hero-title">‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏î‡∏à‡∏≤‡∏Å‡∏ï‡∏•‡∏≤‡∏î</div><div class="hero-subtitle">‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô üöõ</div><div class="hero-emoji">ü¶ê</div></div>
  <div id="annArea"></div>
  <div id="lineBrowserWarn"></div>
  <div id="featuredArea"></div>
  <div class="section-title">üì¶ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
  <div class="category-grid" id="categoryGrid"></div>
  <div id="homeLoading" class="loading"><div class="loading-spinner"></div><div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...</div></div>
</div>

<div class="page" id="categoryPage">
  <button class="back-btn" onclick="goHome()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
  <div class="cat-header" id="catHeader"></div>
  <div id="productList"></div>
</div>

<div class="page" id="cartPage">
  <button class="back-btn" onclick="goHome()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
  <div class="cat-header">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</div>
  <div id="cartList"></div><div id="cartSummary"></div>
</div>

<div class="page" id="checkoutPage">
  <button class="back-btn" onclick="showCart()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
  <div class="cat-header">üí≥ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>
  <div class="input-group"><label class="input-label">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input class="input-field" type="text" id="custName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"></div>
  <div class="input-group"><label class="input-label">‡πÅ‡∏ú‡∏ô‡∏Å / ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label><input class="input-field" type="text" id="custDept" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ù‡πà‡∏≤‡∏¢‡∏ú‡∏•‡∏¥‡∏ï, QC"></div>
  <div class="input-group"><label class="input-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input class="input-field" type="tel" id="custPhone" placeholder="08X-XXX-XXXX"></div>
  <div style="margin-top:20px">
    <div class="input-label">üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á <span style="color:var(--primary)">(‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)</span></div>
    <div class="input-group"><input class="input-field" type="text" id="custAddr" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡πâ‡∏≤‡∏ô/‡∏´‡∏≠‡∏û‡∏±‡∏Å ‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡∏≠‡∏¢ ‡∏ï‡∏≥‡∏ö‡∏•"></div>
    <div class="loc-card" id="locCard">
      <div style="font-family:'Prompt';font-weight:600;font-size:15px;text-align:center">üìç ‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö</div>
      <div class="loc-note">‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏Ç‡∏±‡∏ö‡πÑ‡∏õ‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô/‡∏´‡∏≠‡∏û‡∏±‡∏Å‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ó‡∏µ‡πà</div>
      <button class="loc-btn" id="locBtn" onclick="getLocation()">üìç ‡∏Å‡∏î‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</button>
      <div id="locResult"></div>
    </div>
  </div>
  <div class="payment-section">
    <div class="payment-title">üí∞ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>
    <div class="payment-options">
      <div class="payment-option selected" onclick="selectPayment('now')"><div class="payment-radio"></div><div class="payment-option-info"><div class="payment-option-title">‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏•‡∏¢‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div><div class="payment-option-desc">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</div></div><div class="payment-option-badge free">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</div></div>
      <div class="payment-option" onclick="selectPayment('later')"><div class="payment-radio"></div><div class="payment-option-info"><div class="payment-option-title">‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 25 (‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å)</div><div class="payment-option-desc">‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô +‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</div></div><div class="payment-option-badge">+‡∏ø</div></div>
    </div>
  </div>
  <div id="checkoutSummary"></div>
  <div id="qrSection" style="display:none"><div class="qr-section">
    <div style="font-family:'Prompt';font-weight:700;font-size:16px">‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div>
    <div class="qr-box" id="qrBox"><div style="font-size:50px">üì±</div></div>
    <div class="qr-amount" id="qrAmount">‡∏ø0</div>
    <div class="qr-note">‡∏™‡πÅ‡∏Å‡∏ô‡∏ú‡πà‡∏≤‡∏ô Mobile Banking / PromptPay</div>
    <div style="margin-top:16px;font-family:'Prompt';font-weight:700;font-size:15px">üì∏ ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô <span style="color:var(--primary)">(‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)</span></div>
    <div class="slip-area" id="slipArea" onclick="document.getElementById('slipInput').click()">
      <span style="font-size:48px">üßæ</span>
      <span style="font-family:'Prompt';font-weight:600;font-size:14px;color:var(--text-light)">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ</span>
    </div>
    <input type="file" id="slipInput" accept="image/*" style="display:none" onchange="handleSlip(this)">
  </div></div>
  <button class="btn-primary btn-success" onclick="confirmOrder()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
</div>

<div class="page" id="successPage">
  <div class="success-page">
    <div class="success-icon">‚úÖ</div>
    <div class="success-title">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ</div>
    <div id="orderIdDisplay" class="order-id"></div>
    <div class="success-subtitle" id="successMsg"></div>
    <button class="btn-primary" onclick="resetAll()">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
  </div>
</div>

<div class="page" id="adminPage">
  <button class="back-btn" onclick="goHome()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</button>
  <div class="admin-header"><h2>‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h2><p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Google Sheets ‚Üí ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!</p></div>
  <div id="syncStatus"></div>
  <div class="admin-stat-grid" id="adminStats"></div>
  <div class="admin-section">
    <div class="admin-section-title">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>
    <div style="background:var(--card);border-radius:var(--radius-sm);padding:16px;box-shadow:var(--shadow)">
      <div class="date-range">
        <div class="input-group"><label class="input-label">‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input class="input-field" type="date" id="sumFrom"></div>
        <div class="input-group"><label class="input-label">‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input class="input-field" type="date" id="sumTo"></div>
      </div>
      <button class="btn-primary" onclick="loadOrderSummary()" style="margin-top:0">üîç ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
      <div id="orderSummaryResult"></div>
    </div>
  </div>
  <div class="admin-section">
    <div class="admin-section-title">üì¶ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà & ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <button class="btn-primary btn-sm btn-success" onclick="openAddCatModal()">+ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</button></div>
    <div id="adminProductList"></div>
  </div>
  <div class="admin-section">
    <div class="admin-section-title">üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</div>
    <div style="background:var(--card);border-radius:var(--radius-sm);padding:16px;box-shadow:var(--shadow)">
      <label style="display:flex;align-items:center;gap:8px;margin-bottom:12px;cursor:pointer"><input type="checkbox" id="annEnabled" style="width:20px;height:20px"> <span style="font-family:'Prompt';font-weight:600">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span></label>
      <div class="input-group"><label class="input-label">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</label><input class="input-field" type="text" id="annTitle" placeholder="‡πÄ‡∏ä‡πà‡∏ô üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®"></div>
      <div class="input-group"><label class="input-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label><textarea class="input-field" id="annMsg" rows="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå" style="resize:vertical"></textarea></div>
      <div class="input-group"><label class="input-label">üì∑ ‡∏£‡∏π‡∏õ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® (‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô)</label>
        <div class="upload-area" id="annImgArea" onclick="document.getElementById('annImgInput').click()" style="max-width:200px;aspect-ratio:16/9">
          <span style="font-size:40px">üñºÔ∏è</span><span style="font-family:Prompt;font-weight:600;font-size:13px;color:var(--text-light)">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</span>
        </div>
        <div class="upload-btns"><button type="button" onclick="var i=document.getElementById('annImgInput');i.setAttribute('capture','environment');i.click()">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</button><button type="button" onclick="var i=document.getElementById('annImgInput');i.removeAttribute('capture');i.click()">üñºÔ∏è ‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà</button></div>
        <input type="file" id="annImgInput" accept="image/*" style="display:none" onchange="handleAnnImg(this)">
      </div>
      <button class="btn-primary" onclick="saveAnnouncement()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</button>
    </div>
  </div>
  <div class="admin-section">
    <div class="admin-section-title">üîß ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</div>
    <div class="input-group"><label class="input-label">üì± QR PromptPay ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</label>
      <div class="upload-area" id="qrUploadArea" onclick="document.getElementById('qrUploadInput').click()" style="max-width:180px">
        <span style="font-size:40px">üì±</span><span style="font-family:Prompt;font-weight:600;font-size:13px;color:var(--text-light)">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î QR ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</span>
      </div>
      <div class="upload-btns"><button type="button" onclick="var inp=document.getElementById('qrUploadInput');inp.setAttribute('capture','environment');inp.click()">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</button><button type="button" onclick="var inp=document.getElementById('qrUploadInput');inp.removeAttribute('capture');inp.click()">üñºÔ∏è ‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà</button></div>
      <input type="file" id="qrUploadInput" accept="image/*" style="display:none" onchange="handleQrUpload(this)">
    </div>
    <div class="input-group"><label class="input-label">‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 25 (‡∏ö‡∏≤‡∏ó)</label><input class="input-field" type="number" id="adminFee" placeholder="20"></div>
    <div class="input-group"><label class="input-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin</label><input class="input-field" type="text" id="adminNewPass" placeholder="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà"></div>
    <button class="btn-primary" onclick="saveSettings()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
  </div>
</div>

<div class="bottom-bar" id="bottomBar"><div class="bottom-bar-content"><div class="bottom-bar-info"><div class="bottom-bar-items" id="bottomItems">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div><div class="bottom-bar-total" id="bottomTotal">‡∏ø0</div></div><button class="bottom-bar-btn" onclick="showCart()">üõí ‡∏î‡∏π‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button></div></div>
<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()"><div class="modal" id="modalContent"></div></div>
<div class="toast" id="toast"></div>

<script>
// ‚òÖ‚òÖ‚òÖ CONFIG - ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Apps Script ‡∏ó‡∏µ‡πà Deploy ‡πÅ‡∏•‡πâ‡∏ß ‚òÖ‚òÖ‚òÖ
var API='https://script.google.com/macros/s/AKfycby4PXa-NrnVkKwdK2QV3kXSKbAf_EX00c-wK1RoHyBCLG2zN7VH1cixm66ksn9nmKq1sQ/exec';

var cats={},settings={laterFee:20,adminPass:'1234',qrImg:''},cart={},payMethod='now';
var custSlipImg='',custLat='',custLng='';
var announcement={enabled:false,title:'',message:'',img:''},annImg='';
var _eCatId='',_eItemCatId='',_eItemId='',_aItemCatId='';
var tempUploadImg='';

// ‚òÖ IMAGE COMPRESS & UPLOAD ‚òÖ
function compressImage(file,maxW,quality){
  return new Promise(function(resolve){var reader=new FileReader();reader.onload=function(e){
    var img=new Image();img.onload=function(){var canvas=document.createElement('canvas');
      var w=img.width,h=img.height;if(w>maxW){h=Math.round(h*(maxW/w));w=maxW}if(h>maxW){w=Math.round(w*(maxW/h));h=maxW}
      canvas.width=w;canvas.height=h;canvas.getContext('2d').drawImage(img,0,0,w,h);
      resolve(canvas.toDataURL('image/jpeg',quality))};img.src=e.target.result};reader.readAsDataURL(file)})}
function triggerUpload(mode){var inp=document.getElementById('modalFileInput');
  if(mode==='camera')inp.setAttribute('capture','environment');else inp.removeAttribute('capture');inp.click()}
async function handleModalUpload(input){if(!input.files||!input.files[0])return;showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏µ‡∏ö‡∏£‡∏π‡∏õ...');
  tempUploadImg=await compressImage(input.files[0],400,0.7);
  var a=document.getElementById('modalUploadArea');
  a.innerHTML='<img src="'+tempUploadImg+'"><button class="remove-img" onclick="event.stopPropagation();clearMU()">‚úï</button>';
  a.classList.add('has-img');showToast('‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');input.value=''}
function clearMU(){tempUploadImg='';var a=document.getElementById('modalUploadArea');
  a.innerHTML='<span style="font-size:40px">üì∑</span><span style="font-family:Prompt;font-weight:600;font-size:13px;color:var(--text-light)">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</span>';a.classList.remove('has-img')}

// ‚òÖ QR UPLOAD ‚òÖ
async function handleQrUpload(input){if(!input.files||!input.files[0])return;showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏µ‡∏ö‡∏£‡∏π‡∏õ...');
  settings.qrImg=await compressImage(input.files[0],300,0.8);
  renderQrArea();showToast('‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î QR ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');input.value=''}
function renderQrArea(){var a=document.getElementById('qrUploadArea');
  if(settings.qrImg){a.innerHTML='<img src="'+settings.qrImg+'"><button class="remove-img" onclick="event.stopPropagation();settings.qrImg=\'\';renderQrArea()">‚úï</button>';a.classList.add('has-img')}
  else{a.innerHTML='<span style="font-size:40px">üì±</span><span style="font-family:Prompt;font-weight:600;font-size:13px;color:var(--text-light)">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î QR ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</span>';a.classList.remove('has-img')}}
function uploadHTML(existingImg){
  return '<div class="input-group"><label class="input-label">üì∑ ‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>'+
    '<div class="upload-area '+(existingImg?'has-img':'')+'" id="modalUploadArea" onclick="document.getElementById(\'modalFileInput\').click()">'+
    (existingImg?'<img src="'+existingImg+'"><button class="remove-img" onclick="event.stopPropagation();clearMU()">‚úï</button>':
    '<span style="font-size:40px">üì∑</span><span style="font-family:Prompt;font-weight:600;font-size:13px;color:var(--text-light)">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</span>')+
    '</div><div class="upload-btns"><button type="button" onclick="triggerUpload(\'camera\')">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</button>'+
    '<button type="button" onclick="triggerUpload(\'gallery\')">üñºÔ∏è ‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà</button></div>'+
    '<input type="file" id="modalFileInput" accept="image/*" style="display:none" onchange="handleModalUpload(this)"></div>'}

// ‚òÖ API CALLS ‚òÖ
async function apiGet(action){
  try{var r=await fetch(API+'?action='+action,{redirect:'follow'});
    var text=await r.text();
    try{return JSON.parse(text)}catch(e2){return null}}
  catch(e){showToast('‚ö†Ô∏è ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');return null}}
async function apiPost(data){
  try{await fetch(API,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});return true}
  catch(e){showToast('‚ö†Ô∏è ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');return false}}

// ‚òÖ LOAD DATA FROM SHEETS ‚òÖ
async function loadData(){
  document.getElementById('homeLoading').style.display='block';
  document.getElementById('categoryGrid').innerHTML='';
  document.getElementById('featuredArea').innerHTML='';
  var p=await apiGet('getProducts');
  if(p&&p.cats){cats=p.cats;localStorage.setItem('of_cache',JSON.stringify(cats))}
  else{try{cats=JSON.parse(localStorage.getItem('of_cache'))||{}}catch(e){cats={}}}
  var s=await apiGet('getSettings');
  if(s&&s.settings)settings=Object.assign(settings,s.settings);
  document.getElementById('homeLoading').style.display='none';
  renderHome();
  await loadAnnouncement();
  checkLineBrowser();
}

// ‚òÖ SAVE TO SHEETS (Admin) ‚òÖ
async function syncProducts(){
  showSyncStatus('loading','‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...');
  await apiPost({action:'saveProducts',products:cats});
  showSyncStatus('ok','‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!');
  setTimeout(function(){showSyncStatus('','')},3000);
}
function showSyncStatus(type,msg){
  var el=document.getElementById('syncStatus');
  if(!type){el.innerHTML='';return}
  el.innerHTML='<div class="sync-status sync-'+type+'">'+msg+'</div>';
}

// ‚òÖ HELPERS ‚òÖ
function showToast(m){var t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(function(){t.classList.remove('show')},2200)}
function showPage(id){document.querySelectorAll('.page').forEach(function(p){p.classList.remove('active')});document.getElementById(id).classList.add('active');window.scrollTo(0,0)}
function goHome(){showPage('homePage');renderHome();updateBB()}
function openModal(h){document.getElementById('modalContent').innerHTML=h;document.getElementById('modalOverlay').classList.add('show')}
function closeModal(){document.getElementById('modalOverlay').classList.remove('show');document.getElementById('modalContent').innerHTML='';tempUploadImg=''}
function gid(){return 'p'+Date.now().toString(36)+Math.random().toString(36).substr(2,4)}
function imgH(src,emoji,size){if(!src)return '<span style="font-size:'+(size||'36')+'px">'+emoji+'</span>';return '<img src="'+src+'" style="width:100%;height:100%;object-fit:cover" onerror="this.outerHTML=\'<span style=font-size:'+(size||'36')+'px>'+emoji+'</span>\'">'}
function findP(id){for(var k in cats){var f=(cats[k].items||[]).find(function(p){return p.id===id});if(f)return f}return null}
function gTotal(){var t=0;for(var id in cart){var p=findP(id);if(p)t+=p.price*cart[id]}return t}
function gCount(){var c=0;for(var k in cart)c+=cart[k];return c}
function updateBadge(){var c=gCount(),b=document.getElementById('cartBadge');b.textContent=c;b.classList.toggle('show',c>0)}
function updateBB(){var c=gCount(),t=gTotal(),bar=document.getElementById('bottomBar');var hide=['cartPage','checkoutPage','successPage','adminPage'].some(function(id){return document.getElementById(id).classList.contains('active')});if(c>0&&!hide){bar.classList.add('show');document.getElementById('bottomItems').textContent=c+' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';document.getElementById('bottomTotal').textContent='‡∏ø'+t.toLocaleString()}else bar.classList.remove('show')}

// ‚òÖ CUSTOMER PAGES ‚òÖ
function renderHome(){
  var fh='',fc=null;for(var fid in cats){if(cats[fid].featured){fc=[fid,cats[fid]];break}}
  if(fc){var c=fc[1];fh='<div class="featured-card" onclick="goToCat(\''+fc[0]+'\')"><div class="featured-img">'+(c.img?'<img src="'+c.img+'" style="width:100%;height:100%;object-fit:cover">':c.emoji)+'<div class="featured-tag">‚≠ê ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div></div><div class="featured-info"><div class="featured-name">'+c.name+'</div><div class="featured-price">'+(c.featuredPrice||'')+'</div></div></div>'}
  document.getElementById('featuredArea').innerHTML=fh;
  var h='';for(var id in cats){var c=cats[id];if(c.featured)continue;if(!(c.items||[]).length)continue;
    h+='<div class="category-card" onclick="goToCat(\''+id+'\')"><div class="cimg">'+(c.img?'<img src="'+c.img+'">':c.emoji)+'</div><div class="category-text"><div class="category-name">'+c.name+'</div><div class="category-count">'+c.items.length+' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div></div></div>'}
  document.getElementById('categoryGrid').innerHTML=h||'<div class="empty-state"><div class="empty-state-icon">üì≠</div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>';
}
function goToCat(cid){var c=cats[cid];if(!c)return;document.getElementById('catHeader').innerHTML=c.emoji+' '+c.name;var h='';
  (c.items||[]).forEach(function(it){var q=cart[it.id]||0;h+='<div class="product-card"><div class="pimg">'+imgH(it.img,it.emoji,36)+'</div><div class="product-info"><div class="product-name">'+it.name+'</div><div class="product-price">‡∏ø'+it.price+' <span class="product-unit">/ '+(it.unit||'‡∏ä‡∏¥‡πâ‡∏ô')+'</span></div></div><div class="qty-control"><button class="qty-btn minus" onclick="chgQty(\''+it.id+'\',-1)">‚àí</button><div class="qty-value" id="qty-'+it.id+'">'+q+'</div><button class="qty-btn plus" onclick="chgQty(\''+it.id+'\',1)">+</button></div></div>'});
  if(!h)h='<div class="empty-state"><div class="empty-state-icon">üì≠</div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>';
  document.getElementById('productList').innerHTML=h;showPage('categoryPage');updateBB()}
function chgQty(id,d){if(!cart[id])cart[id]=0;cart[id]=Math.max(0,cart[id]+d);if(!cart[id])delete cart[id];var el=document.getElementById('qty-'+id);if(el)el.textContent=cart[id]||0;updateBadge();updateBB();if(d>0)showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‚úì')}

// CART
function showCart(){var items=Object.entries(cart),L=document.getElementById('cartList'),S=document.getElementById('cartSummary');
  if(!items.length){L.innerHTML='<div class="cart-empty"><div class="cart-empty-icon">üõí</div><div class="cart-empty-text">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</div><button class="btn-outline" onclick="goHome()" style="margin-top:20px">üè† ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button></div>';S.innerHTML=''}
  else{var h='',total=0;items.forEach(function(e){var id=e[0],qty=e[1],p=findP(id);if(!p)return;var sub=p.price*qty;total+=sub;
    h+='<div class="cart-item"><div class="pimg" style="width:44px;height:44px">'+imgH(p.img,p.emoji,28)+'</div><div class="cart-item-info"><div class="cart-item-name">'+p.name+'</div><div class="cart-item-price">‡∏ø'+p.price+' √ó '+qty+' = ‡∏ø'+sub.toLocaleString()+'</div></div><div class="qty-control"><button class="qty-btn minus" onclick="chgC(\''+id+'\',-1)">‚àí</button><div class="qty-value">'+qty+'</div><button class="qty-btn plus" onclick="chgC(\''+id+'\',1)">+</button></div><button class="remove-btn" onclick="rmCart(\''+id+'\')">‚úï</button></div>'});
    L.innerHTML=h;S.innerHTML='<div class="summary-card"><div class="summary-row"><span class="summary-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span><span>'+gCount()+' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></div><div class="summary-row total"><span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span><span class="total-amount">‡∏ø'+total.toLocaleString()+'</span></div></div><button class="btn-primary" onclick="goCheckout()">üí≥ ‡πÑ‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button><button class="btn-outline" onclick="goHome()">‚Üê ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°</button>'}
  showPage('cartPage');updateBB()}
function chgC(id,d){if(!cart[id])cart[id]=0;cart[id]=Math.max(0,cart[id]+d);if(!cart[id])delete cart[id];updateBadge();showCart()}
function rmCart(id){delete cart[id];updateBadge();showCart()}

// CHECKOUT
function goCheckout(){payMethod='now';custSlipImg='';updCS();updPay();showPage('checkoutPage');updateBB()}
function selectPayment(m){payMethod=m;updPay();updCS()}
function updPay(){document.querySelectorAll('.payment-option').forEach(function(el,i){el.classList.toggle('selected',(i===0&&payMethod==='now')||(i===1&&payMethod==='later'))});
  document.getElementById('qrSection').style.display=payMethod==='now'?'block':'none';
  if(payMethod==='now'){document.getElementById('qrAmount').textContent='‡∏ø'+gTotal().toLocaleString();
    var qb=document.getElementById('qrBox');
    if(settings.qrImg)qb.innerHTML='<img src="'+settings.qrImg+'">';
    else qb.innerHTML='<div style="font-size:50px">üì±</div><div style="font-size:12px;color:var(--text-light);padding:0 10px;text-align:center">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î QR ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Admin</div>'}}
function updCS(){var t=gTotal(),fee=payMethod==='later'?(Number(settings.laterFee)||20):0,f=t+fee;
  document.getElementById('checkoutSummary').innerHTML='<div class="summary-card"><div class="summary-row"><span class="summary-label">‡∏¢‡∏≠‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span><span>‡∏ø'+t.toLocaleString()+'</span></div>'+(fee?'<div class="summary-row"><span class="summary-label">‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</span><span style="color:var(--accent)">+‡∏ø'+fee+'</span></div>':'')+'<div class="summary-row total"><span>‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞</span><span class="total-amount">‡∏ø'+f.toLocaleString()+'</span></div></div>'}

// LOCATION
function getLocation(){var btn=document.getElementById('locBtn');btn.innerHTML='‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î...';btn.disabled=true;
  if(!navigator.geolocation){showToast('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS');btn.innerHTML='üìç ‡∏Å‡∏î‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î';btn.disabled=false;return}
  navigator.geolocation.getCurrentPosition(function(pos){custLat=pos.coords.latitude.toFixed(6);custLng=pos.coords.longitude.toFixed(6);
    btn.innerHTML='‚úÖ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß';btn.classList.add('done');btn.disabled=false;document.getElementById('locCard').classList.add('has-loc');
    document.getElementById('locResult').innerHTML='<div style="font-family:Prompt;font-weight:600;font-size:13px;color:var(--green-dark);margin-top:8px;text-align:center">üìç '+custLat+', '+custLng+' <a href="https://www.google.com/maps?q='+custLat+','+custLng+'" target="_blank" style="color:#3498db">‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</a></div>';
  },function(){var isLine=/Line\//i.test(navigator.userAgent||'');
    showToast(isLine?'‚ùå LINE ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå':'‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï GPS ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö');btn.innerHTML='üìç ‡∏Å‡∏î‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î';btn.disabled=false},{enableHighAccuracy:true,timeout:15000})}

// SLIP
function handleSlip(input){if(!input.files||!input.files[0])return;var reader=new FileReader();reader.onload=function(e){custSlipImg=e.target.result;
  var a=document.getElementById('slipArea');a.innerHTML='<img src="'+custSlipImg+'"><button class="remove-img" onclick="event.stopPropagation();clearSlip()">‚úï</button>';a.classList.add('has-img');showToast('‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ')};reader.readAsDataURL(input.files[0]);input.value=''}
function clearSlip(){custSlipImg='';var a=document.getElementById('slipArea');a.innerHTML='<span style="font-size:48px">üßæ</span><span style="font-family:Prompt;font-weight:600;font-size:14px;color:var(--text-light)">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ</span>';a.classList.remove('has-img')}

// CONFIRM ORDER
function confirmOrder(){
  var name=document.getElementById('custName').value.trim();if(!name){showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠');return}
  if(!custLat||!custLng){showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS ‡∏Å‡πà‡∏≠‡∏ô üìç');return}
  if(payMethod==='now'&&!custSlipImg){showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô üßæ');return}
  var dept=document.getElementById('custDept').value.trim(),phone=document.getElementById('custPhone').value.trim(),addr=document.getElementById('custAddr').value.trim();
  var fee=payMethod==='later'?(Number(settings.laterFee)||20):0,total=gTotal()+fee;
  var oid='OF-'+Date.now().toString(36).toUpperCase();
  var oi=[];for(var id in cart){var p=findP(id);if(p)oi.push({name:p.name,price:p.price,qty:cart[id],emoji:p.emoji})}
  var locUrl='https://www.google.com/maps?q='+custLat+','+custLng;
  document.getElementById('orderIdDisplay').textContent='‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå: '+oid;
  var msg='‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á '+name;if(dept)msg+=' ('+dept+')';if(addr)msg+='<br>üìç '+addr;
  msg+='<br>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° ‡∏ø'+total.toLocaleString();msg+=payMethod==='later'?'<br>üí∏ ‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 25':'<br>‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ)';msg+='<br><br>‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üöõ';
  document.getElementById('successMsg').innerHTML=msg;
  apiPost({action:'newOrder',date:new Date().toLocaleString('th-TH'),orderId:oid,name:name,dept:dept,
    items:oi.map(function(i){return i.emoji+i.name+'x'+i.qty}).join(', '),total:total,
    payment:payMethod==='now'?'‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏°‡∏µ‡∏™‡∏•‡∏¥‡∏õ)':'‡∏£‡∏≠‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 25',addr:addr,location:locUrl,
    slipImg:payMethod==='now'?custSlipImg:''});
  showPage('successPage');updateBB()}
function resetAll(){cart={};payMethod='now';custSlipImg='';custLat='';custLng='';['custName','custDept','custPhone','custAddr'].forEach(function(id){document.getElementById(id).value=''});updateBadge();goHome()}

// ‚òÖ ADMIN ‚òÖ
function openAdminLogin(){openModal('<h3>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin</h3><div class="input-group"><label class="input-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label><input class="input-field" type="password" id="adminPassInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" onkeydown="if(event.key===\'Enter\')doLogin()"></div><button class="btn-primary" onclick="doLogin()">üîì ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button><div style="text-align:center;margin-top:12px;font-size:13px;color:var(--text-light)">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: 1234</div>');
  setTimeout(function(){var el=document.getElementById('adminPassInput');if(el)el.focus()},300)}
function doLogin(){var input=document.getElementById('adminPassInput').value;var pass=String(settings.adminPass||'1234');
  if(input===pass){closeModal();openAdmin()}else showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚ùå')}
function openAdmin(){showPage('adminPage');updateBB();renderAdminStats();renderAdminProducts();renderQrArea();renderAnnAdmin();
  document.getElementById('adminFee').value=settings.laterFee||20;document.getElementById('adminNewPass').value='';
  // Set default date range to today
  var today=new Date().toISOString().split('T')[0];
  document.getElementById('sumFrom').value=today;document.getElementById('sumTo').value=today}
function renderAdminStats(){var tp=0,tc=Object.keys(cats).length;for(var k in cats)tp+=(cats[k].items||[]).length;
  document.getElementById('adminStats').innerHTML='<div class="admin-stat"><div class="admin-stat-num">'+tc+'</div><div class="admin-stat-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</div></div><div class="admin-stat"><div class="admin-stat-num">'+tp+'</div><div class="admin-stat-label">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div></div>'}
function renderAdminProducts(){var h='';for(var cid in cats){var c=cats[cid];
    h+='<div class="admin-cat-header"><div class="admin-cat-name">'+c.emoji+' '+c.name+' <span style="font-weight:400;font-size:13px;color:var(--text-light)">'+(c.items||[]).length+'</span></div><div style="display:flex;gap:6px"><button class="btn-primary btn-sm btn-success" onclick="openAddItemModal(\''+cid+'\')" style="font-size:12px;padding:6px 12px">+ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button><button class="btn-edit" style="width:32px;height:32px;border-radius:8px;border:none;cursor:pointer" onclick="openEditCatModal(\''+cid+'\')">‚úèÔ∏è</button><button class="btn-del" style="width:32px;height:32px;border-radius:8px;border:none;cursor:pointer" onclick="delCat(\''+cid+'\')">üóëÔ∏è</button></div></div>';
    (c.items||[]).forEach(function(it){h+='<div class="admin-item"><div class="pimg" style="width:44px;height:44px">'+imgH(it.img,it.emoji,28)+'</div><div class="admin-item-info"><div class="admin-item-name">'+it.name+'</div><div class="admin-item-detail">‡∏ø'+it.price+' / '+(it.unit||'‡∏ä‡∏¥‡πâ‡∏ô')+(it.img?' üì∑':'')+'</div></div><div class="admin-item-actions"><button class="btn-edit" onclick="openEditItemModal(\''+cid+'\',\''+it.id+'\')">‚úèÔ∏è</button><button class="btn-del" onclick="delItem(\''+cid+'\',\''+it.id+'\')">üóëÔ∏è</button></div></div>'})}
  document.getElementById('adminProductList').innerHTML=h||'<div class="empty-state"><div class="empty-state-icon">üì¶</div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</div>'}

// ADMIN CRUD - ‡πÉ‡∏ä‡πâ global var ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô escape bug
function openAddCatModal(){tempUploadImg='';openModal('<h3>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3><div class="input-group"><label class="input-label">‡∏ä‡∏∑‡πà‡∏≠</label><input class="input-field" id="m_cn" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°"></div><div class="input-group"><label class="input-label">Emoji</label><input class="input-field" id="m_ce" placeholder="ü•§"></div>'+uploadHTML('')+'<button class="btn-primary btn-success" onclick="doAddCat()">‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>')}
function doAddCat(){var n=document.getElementById('m_cn').value.trim();if(!n){showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠');return}
  cats['cat_'+Date.now().toString(36)]={name:n,emoji:document.getElementById('m_ce').value.trim()||'üì¶',img:tempUploadImg,items:[]};
  closeModal();syncProducts();renderAdminProducts();renderAdminStats();showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß ‚úÖ')}

function openEditCatModal(cid){var c=cats[cid];if(!c)return;_eCatId=cid;tempUploadImg=c.img||'';
  openModal('<h3>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3><div class="input-group"><label class="input-label">‡∏ä‡∏∑‡πà‡∏≠</label><input class="input-field" id="m_cn" value="'+c.name+'"></div><div class="input-group"><label class="input-label">Emoji</label><input class="input-field" id="m_ce" value="'+c.emoji+'"></div>'+uploadHTML(c.img||'')+'<div class="input-group"><label class="input-label">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</label><input class="input-field" id="m_cfp" value="'+(c.featuredPrice||'')+'"></div><label style="display:flex;align-items:center;gap:8px;margin:12px 0"><input type="checkbox" id="m_cf" '+(c.featured?'checked':'')+' style="width:20px;height:20px"> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</label><button class="btn-primary" onclick="doEditCat()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>')}
function doEditCat(){var c=cats[_eCatId];if(!c)return;c.name=document.getElementById('m_cn').value.trim()||c.name;c.emoji=document.getElementById('m_ce').value.trim()||c.emoji;c.img=tempUploadImg;c.featuredPrice=document.getElementById('m_cfp').value.trim();
  var f=document.getElementById('m_cf').checked;for(var k in cats)cats[k].featured=false;if(f)c.featured=true;
  closeModal();syncProducts();renderAdminProducts();showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ')}
function delCat(cid){if(!confirm('‡∏•‡∏ö "'+cats[cid].name+'" ?'))return;delete cats[cid];syncProducts();renderAdminProducts();renderAdminStats()}

function openAddItemModal(cid){_aItemCatId=cid;tempUploadImg='';var c=cats[cid];
  openModal('<h3>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô '+c.emoji+' '+c.name+'</h3><div class="input-group"><label class="input-label">‡∏ä‡∏∑‡πà‡∏≠</label><input class="input-field" id="m_in" placeholder="‡∏õ‡∏•‡∏≤‡∏ó‡∏π"></div><div class="input-group"><label class="input-label">‡∏£‡∏≤‡∏Ñ‡∏≤</label><input class="input-field" type="number" id="m_ip" placeholder="50"></div><div class="input-group"><label class="input-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢</label><input class="input-field" id="m_iu" value="‡∏Å‡∏Å."></div><div class="input-group"><label class="input-label">Emoji</label><input class="input-field" id="m_ie" placeholder="üêü"></div>'+uploadHTML('')+'<button class="btn-primary btn-success" onclick="doAddItem()">‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>')}
function doAddItem(){var n=document.getElementById('m_in').value.trim(),pr=parseInt(document.getElementById('m_ip').value)||0;if(!n||!pr){showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤');return}
  if(!cats[_aItemCatId].items)cats[_aItemCatId].items=[];
  cats[_aItemCatId].items.push({id:gid(),name:n,price:pr,unit:document.getElementById('m_iu').value.trim()||'‡∏Å‡∏Å.',emoji:document.getElementById('m_ie').value.trim()||'üì¶',img:tempUploadImg});
  closeModal();syncProducts();renderAdminProducts();renderAdminStats();showToast('‡πÄ‡∏û‡∏¥‡πà‡∏° "'+n+'" ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ')}

function openEditItemModal(cid,iid){var c=cats[cid];if(!c)return;var it=(c.items||[]).find(function(i){return i.id===iid});if(!it)return;
  _eItemCatId=cid;_eItemId=iid;tempUploadImg=it.img||'';
  openModal('<h3>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç '+it.emoji+' '+it.name+'</h3><div class="input-group"><label class="input-label">‡∏ä‡∏∑‡πà‡∏≠</label><input class="input-field" id="m_in" value="'+it.name+'"></div><div class="input-group"><label class="input-label">‡∏£‡∏≤‡∏Ñ‡∏≤</label><input class="input-field" type="number" id="m_ip" value="'+it.price+'"></div><div class="input-group"><label class="input-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢</label><input class="input-field" id="m_iu" value="'+(it.unit||'‡∏Å‡∏Å.')+'"></div><div class="input-group"><label class="input-label">Emoji</label><input class="input-field" id="m_ie" value="'+it.emoji+'"></div>'+uploadHTML(it.img||'')+'<button class="btn-primary" onclick="doEditItem()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>')}
function doEditItem(){var it=(cats[_eItemCatId].items||[]).find(function(i){return i.id===_eItemId});if(!it)return;
  it.name=document.getElementById('m_in').value.trim()||it.name;it.price=parseInt(document.getElementById('m_ip').value)||it.price;
  it.unit=document.getElementById('m_iu').value.trim()||it.unit;it.emoji=document.getElementById('m_ie').value.trim()||it.emoji;it.img=tempUploadImg;
  closeModal();syncProducts();renderAdminProducts();showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ')}
function delItem(cid,iid){var it=(cats[cid].items||[]).find(function(i){return i.id===iid});if(!it||!confirm('‡∏•‡∏ö "'+it.name+'" ?'))return;
  cats[cid].items=cats[cid].items.filter(function(i){return i.id!==iid});syncProducts();renderAdminProducts();renderAdminStats()}

function saveSettings(){
  settings.laterFee=parseInt(document.getElementById('adminFee').value)||20;
  var np=document.getElementById('adminNewPass').value.trim();if(np)settings.adminPass=np;
  apiPost({action:'saveSettings',settings:settings});showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‚úÖ')}

// ‚òÖ ANNOUNCEMENT (inline on homepage) ‚òÖ
async function loadAnnouncement(){
  var a=await apiGet('getAnnouncement');
  if(a&&a.announcement)announcement=a.announcement;
  renderAnnouncement()}
function renderAnnouncement(){
  var el=document.getElementById('annArea');
  if(!announcement.enabled||(!announcement.message&&!announcement.img)){el.innerHTML='';return}
  var h='<div class="ann-card"><div class="ann-card-header">'+(announcement.title||'üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®')+'</div><div class="ann-card-body">';
  if(announcement.message)h+='<p>'+announcement.message+'</p>';
  if(announcement.img)h+='<img src="'+announcement.img+'">';
  h+='</div></div>';
  el.innerHTML=h}

// ‚òÖ LINE Browser Detection ‚òÖ
function checkLineBrowser(){
  var ua=navigator.userAgent||'';
  var isLine=/Line\//i.test(ua);
  var el=document.getElementById('lineBrowserWarn');
  if(isLine){
    var url=window.location.href;
    el.innerHTML='<div class="line-warn"><div style="font-family:Prompt;font-weight:700;font-size:14px">‚ö†Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏≠‡∏¢‡∏π‡πà</div><div style="font-size:13px;color:var(--text-mid);margin-top:4px">GPS / ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</div><a href="'+url+'" target="_blank">üåê ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</a></div>'
  }else{el.innerHTML=''}}
async function handleAnnImg(input){if(!input.files||!input.files[0])return;showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏µ‡∏ö‡∏£‡∏π‡∏õ...');
  annImg=await compressImage(input.files[0],500,0.75);
  var a=document.getElementById('annImgArea');
  a.innerHTML='<img src="'+annImg+'"><button class="remove-img" onclick="event.stopPropagation();clearAnnImg()">‚úï</button>';
  a.classList.add('has-img');showToast('‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');input.value=''}
function clearAnnImg(){annImg='';var a=document.getElementById('annImgArea');
  a.innerHTML='<span style="font-size:40px">üñºÔ∏è</span><span style="font-family:Prompt;font-weight:600;font-size:13px;color:var(--text-light)">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</span>';a.classList.remove('has-img')}
function renderAnnAdmin(){
  document.getElementById('annEnabled').checked=announcement.enabled;
  document.getElementById('annTitle').value=announcement.title||'';
  document.getElementById('annMsg').value=announcement.message||'';
  annImg=announcement.img||'';
  var a=document.getElementById('annImgArea');
  if(annImg){a.innerHTML='<img src="'+annImg+'"><button class="remove-img" onclick="event.stopPropagation();clearAnnImg()">‚úï</button>';a.classList.add('has-img')}
  else{a.innerHTML='<span style="font-size:40px">üñºÔ∏è</span><span style="font-family:Prompt;font-weight:600;font-size:13px;color:var(--text-light)">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</span>';a.classList.remove('has-img')}}
function saveAnnouncement(){
  announcement.enabled=document.getElementById('annEnabled').checked;
  announcement.title=document.getElementById('annTitle').value.trim();
  announcement.message=document.getElementById('annMsg').value.trim();
  announcement.img=annImg;
  apiPost({action:'saveAnnouncement',announcement:announcement});showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÅ‡∏•‡πâ‡∏ß ‚úÖ')}

// ‚òÖ ORDER SUMMARY ‚òÖ
async function loadOrderSummary(){
  var from=document.getElementById('sumFrom').value;
  var to=document.getElementById('sumTo').value;
  if(!from||!to){showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');return}
  var el=document.getElementById('orderSummaryResult');
  el.innerHTML='<div style="text-align:center;padding:20px;color:var(--text-light)">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
  
  // ‡πÉ‡∏ä‡πâ GET with proper URL encoding
  var url=API+'?action=getOrders&from='+encodeURIComponent(from)+'&to='+encodeURIComponent(to);
  var r=null;
  try{
    var resp=await fetch(url,{redirect:'follow'});
    var text=await resp.text();
    r=JSON.parse(text);
  }catch(e){r=null}
  
  if(!r||!r.orders){el.innerHTML='<div style="text-align:center;padding:20px;color:var(--text-light)">‚ùå ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>';return}
  
  // Filter by date on client side
  var fromD=new Date(from);fromD.setHours(0,0,0,0);
  var toD=new Date(to);toD.setHours(23,59,59,999);
  var orders=r.orders.filter(function(o){
    var ds=o.date;
    // Parse "8/2/2569 11:54:10" or "8/2/2569, 11:54:10" ‚Üí Thai Buddhist Era
    var parts=ds.match(/(\d+)\/(\d+)\/(\d+)/);
    if(parts){
      var day=parseInt(parts[1]);
      var mon=parseInt(parts[2])-1;
      var yr=parseInt(parts[3]);
      if(yr>2500)yr-=543; // ‡∏û.‡∏®. ‚Üí ‡∏Ñ.‡∏®.
      var d=new Date(yr,mon,day);
      return d>=fromD&&d<=toD;
    }
    // Fallback: try native parse
    var d2=new Date(ds);
    if(!isNaN(d2.getTime()))return d2>=fromD&&d2<=toD;
    return true; // parse ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô
  });
  if(!orders.length){el.innerHTML='<div style="text-align:center;padding:20px;color:var(--text-light)">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ</div>';return}
  
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏™‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
  var h='';
  var grandTotal=0;
  var shoppingList={};
  
  orders.forEach(function(o){
    grandTotal+=o.total;
    h+='<div class="summary-item"><div class="summary-item-header"><span class="summary-item-name">'+o.name+(o.dept?' ('+o.dept+')':'')+'</span><span class="summary-item-total">‡∏ø'+o.total.toLocaleString()+'</span></div><div class="summary-item-items">'+o.items+'</div><div style="font-size:12px;color:var(--text-light)">'+o.date+(o.time?' '+o.time:'')+' ‚Ä¢ '+o.payment+'</div></div>';
    
    // ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡∏ã‡∏∑‡πâ‡∏≠
    if(o.items){
      o.items.split(', ').forEach(function(item){
        // Parse: "ü¶ê‡∏Å‡∏∏‡πâ‡∏á‡∏™‡∏îx2" ‚Üí name="‡∏Å‡∏∏‡πâ‡∏á‡∏™‡∏î", qty=2
        var m=item.match(/(.+?)x(\d+)$/);
        if(m){
          var name=m[1].replace(/^[\u{1F000}-\u{1FFFF}]/u,'').trim();
          var qty=parseInt(m[2])||1;
          if(!shoppingList[name])shoppingList[name]=0;
          shoppingList[name]+=qty;
        }
      });
    }
  });
  
  // ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°
  var result='<div class="summary-totals"><div class="summary-totals-num">'+orders.length+' ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‚Ä¢ ‡∏ø'+grandTotal.toLocaleString()+'</div><div class="summary-totals-label">'+from+' ‡∏ñ‡∏∂‡∏á '+to+'</div></div>';
  
  // ‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠
  result+='<div class="summary-shopping"><h4>üõí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏ã‡∏∑‡πâ‡∏≠</h4>';
  var shopKeys=Object.keys(shoppingList);
  if(shopKeys.length){
    shopKeys.forEach(function(name){
      result+='<div class="shopping-item"><span>'+name+'</span><span style="font-weight:700">'+shoppingList[name]+' ‡∏ä‡∏¥‡πâ‡∏ô</span></div>';
    });
  }else{result+='<div style="color:var(--text-light);font-size:13px">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>'}
  result+='</div>';
  
  // ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á LINE
  result+='<button class="btn-primary btn-line" onclick="sendSummaryLine()" style="margin-top:14px">üì≤ ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÑ‡∏õ LINE</button>';
  
  // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
  result+='<div style="margin-top:14px;font-family:Prompt;font-weight:700;font-size:15px">üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div><div class="summary-list">'+h+'</div>';
  
  el.innerHTML=result;
  
  // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á LINE
  window._summaryData={from:from,to:to,orders:orders,grandTotal:grandTotal,shoppingList:shoppingList};
}

async function sendSummaryLine(){
  if(!window._summaryData){showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô');return}
  var d=window._summaryData;
  var msg='üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠\nüìÖ '+d.from+' ‡∏ñ‡∏∂‡∏á '+d.to+'\n'
    +'üìä '+d.orders.length+' ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡∏£‡∏ß‡∏° ‡∏ø'+d.grandTotal.toLocaleString()+'\n\n';
  
  msg+='üõí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠:\n';
  var sl=d.shoppingList;
  for(var name in sl){
    msg+='‚Ä¢ '+name+' √ó '+sl[name]+'\n';
  }
  
  msg+='\nüì¶ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:\n';
  d.orders.forEach(function(o,i){
    msg+=(i+1)+'. '+o.name+(o.dept?' ('+o.dept+')':'')+' - '+o.items+' ‡∏ø'+o.total.toLocaleString()+' ['+o.payment+']\n';
  });
  
  showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á LINE...');
  await apiPost({action:'sendSummaryLine',message:msg});
  showToast('‚úÖ ‡∏™‡πà‡∏á‡πÑ‡∏õ LINE ‡πÅ‡∏•‡πâ‡∏ß!');
}

// INIT
loadData();
</script>
</body>
</html>
